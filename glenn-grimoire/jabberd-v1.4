# This spell released under the terms of the GNU General Public License
# as they appear in http://www.gnu.org/licenses/gpl.txt
  VERSION=( "1.4.3" "1.4.2" )
 CATEGORY="network chat"
ATTRIBUTE="server"
SOURCE[0]="$SPELL-$VERSION"
SOURCE[1]="pth-1.4.0.tar.gz"
 HOMEPAGE="http://jabberd.jabberstudio.org"
   URL[0]="http://jabberd.jabberstudio.org/1.4/dist"
   URL[1]="ftp://ftp.ossp.org/pkg/lib/pth"
 EPROVIDE="jabberd"
# Nearly all of these requirements should be OPT[x], AND need to add pth
      REQ=( "Linux-PAM db postgresql"
            "openssl:--enable-ssl::enable SSL support" )
   OPT[0]="openssl:--enable-ssl::enable SSL support"
#FRESHMEAT=""
DESC="Jabberd 1.4.x server
Jabberd 1.4.x server
"

build() {
  #OPTS="--enable-debug --enable-storage=\"pgsql db fs\" --enable-authreg=\"anon pipe pgsql pam ldap db\""
  #echo $OPTS >> myconfig
  #default_build
  
  unpack $( guess_filename "${SOURCE[1]}" "$SOURCE_CACHE/$SPELL/$VERSION" ) &&
  mv $(basename ${SOURCE[1]} .tar.gz) jabberd &&
  ./configure --enable-ipv6   \
              $OPTS           &&
  make                        &&
  prepare_install             &&
  make install                &&
  cp jabberd/jabberd /usr/bin &&
  mkdir -p /usr/share/$SPELL &&
  cp generateSSLkey jabber.xml /usr/share/$SPELL &&
  mkdir -p  /etc/$SPELL      &&
  cp jabber.xml /etc/$SPELL  &&
  mkdir -p  /usr/lib/$SPELL  &&
  cp jsm/jsm.so xdb_file/xdb_file.so pthsock/pthsock_client.so \
     dnsrv/dnsrv.so dialback/dialback.so /usr/lib/$SPELL &&
  mkdir -p /var/spool/$SPELL
}
